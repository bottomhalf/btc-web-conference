<!-- Incoming Call Notification (bottom-right, no overlay) -->
@if (serverEventService.hasIncomingCall()) {
<div class="notification-container">
    <div class="incoming-call-card" [class.video-call]="isVideoCall()">
        <!-- Animated rings -->
        <div class="pulse-ring"></div>
        <div class="pulse-ring delay-1"></div>
        <div class="pulse-ring delay-2"></div>

        <!-- Call type indicator -->
        <div class="call-type-badge">
            @if (isVideoCall()) {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
            <span>Video Call</span>
            } @else {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
            </svg>
            <span>Audio Call</span>
            }
        </div>

        <!-- Caller avatar -->
        <div class="caller-avatar">
            @if (incomingCall()?.callerAvatar) {
            <img [src]="incomingCall()?.callerAvatar" alt="Caller">
            } @else {
            <div class="avatar-placeholder">
                {{ getCallerInitial() }}
            </div>
            }
        </div>

        <!-- Caller info -->
        <div class="caller-info">
            <h3 class="caller-name">{{ getCallerName() }}</h3>
            <p class="call-status">Incoming call...</p>
        </div>

        <!-- Timer -->
        <div class="call-timer">{{ formatTime(callDuration()) }}</div>

        <!-- Action buttons -->
        <div class="call-actions">
            <button class="action-btn decline" (click)="declineCall()" title="Decline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path
                        d="M23 7c0 0-3.5-4-11-4S1 7 1 7v3c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2V8s2.7-2 5-2 5 2 5 2v2c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2V7z"
                        transform="rotate(135 12 12)" />
                </svg>
            </button>
            <button class="action-btn accept" (click)="acceptCall()" title="Accept">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                </svg>
            </button>
        </div>
    </div>
</div>
}

<!-- Join Call Notification (bottom-right, positioned above incoming call if both shown) -->
@if (serverEventService.hasJoiningRequest()) {
<div class="notification-container join-request" [class.stacked]="serverEventService.hasIncomingCall()">
    <div class="join-call-card">
        <!-- Join icon with pulse -->
        <div class="join-icon-container">
            <div class="join-pulse-ring"></div>
            <div class="join-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
        </div>

        <!-- Call info -->
        <div class="join-info">
            <h4 class="join-title">Call in Progress</h4>
            <p class="join-message">{{ getJoinCallerName() }} started a call</p>
            <p class="join-subtext">You're invited to join</p>
        </div>

        <!-- Action buttons -->
        <div class="join-actions">
            <button class="join-btn dismiss" (click)="dismissJoinRequest()" title="Dismiss">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                <span>Dismiss</span>
            </button>
            <button class="join-btn join" (click)="joinCall()" title="Join Call">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                </svg>
                <span>Join</span>
            </button>
        </div>
    </div>
</div>
}